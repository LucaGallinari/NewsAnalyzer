{% extends "base.html" %}

{% block title %}
    <title>News Analyzer - Analyze</title>
{% endblock %}


{% block js %}
{% endblock %}

{% block content %}

    <div class="row">
        <div class="xl9 offset-xl1">
            <h4 class="deep-orange-text">Analyzation</h4>
                <div class="row">
                    <form class="col s12" method="get">
                        <div class="input-field col s8 m9">
                            <input id="url" type="text" name="url" value="{{ url }}">
                            <label for="url">Paste the link here</label>
                        </div>
                        <div class="input-field col s4 m3">
                            <button class="btn waves-effect waves-light" type="submit">
                                Analyze<i class="material-icons right">language</i>
                            </button>
                        </div>
                    </form>
                </div>

                {% if data is defined %}
                    {% if data|length == 0 %}
                        <div class="card-panel red-text lighten-1">
                            Non Ã¨ stato possibile analizzare la notizia. Prova con un'altra!
                        </div>
                    {% else %}
                        <div>
                            <ul class="collapsible popout" data-collapsible="accordion">
                            {% for item in data %}
                                <li class="entity">
                                    <div class="collapsible-header" data-index="{{ loop.index }}" data-label="{{ item.label }}">
                                        {% if 'categ' in item %}
                                        <div class="category cat-{{ item.categ|lower }}">{{ item.categ }}</div>
                                        {% endif %}
                                        <div><h6>{{ item.label }}</h6></div>
                                    </div>
                                    <div class="collapsible-body">
                                        <div class="row">
                                            <div class="col s4">
                                                {% if 'thumbnail' in item.image %}
                                                <img src="{{ item.image.thumbnail }}" onerror="this.onerror=null;this.src='/assets/images/img_not_available.png';">
                                                {% else %}
                                                <img src="/assets/images/img_not_available.png">
                                                {% endif %}
                                            </div>
                                            <div class="col s8">
                                                <div>{{ item.abstract }}</div>
                                                <div><a href="{{ item.uri }}" target="_blank">More..</a></div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col s12">
                                                <div id="loading-{{loop.index}}" class="progress row">
                                                    <div class="indeterminate"></div>
                                                </div>
                                            </div>
                                            <div>
                                                <a class="more-images" href="#" data-index="{{ loop.index }}" data-label="{{ item.label }}">More images..</a>
                                            </div>
                                        </div>
                                        {% if 'types' in item %}
                                        <div class="row">
                                            <div class="col s12">Types</div>
                                            <small class="col s12">
                                                <ul>
                                                {% for k in item.types %}
                                                    <li>{{ k }}</li>
                                                {% endfor %}
                                                </ul>
                                            </small>
                                        </div>
                                        {% endif %}
                                    </div>
                                </li>
                            {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                {% endif %}

        </div>
    </div>

{% endblock %}

{% block endscript %}

    <script type="text/javascript" src="/assets/js/analyzeJs.js"></script>

    <script type="text/javascript">
        $(document).ready(function() {
            $('select').material_select();
            $('.progress').hide();
        });
    </script>
{% endblock %}